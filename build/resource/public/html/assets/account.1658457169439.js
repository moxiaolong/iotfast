var E=Object.defineProperty;var S=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,U=Object.prototype.propertyIsEnumerable;var k=(e,o,t)=>o in e?E(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,A=(e,o)=>{for(var t in o||(o={}))P.call(o,t)&&k(e,t,o[t]);if(S)for(var t of S(o))U.call(o,t)&&k(e,t,o[t]);return e};import{s as C,_ as b,c as R,u as q,d as B,e as D,S as f,g as T,i as K,h as N,E as O,N as M}from"./index.1658457169439.js";import{j as L,aw as j,aB as z,aE as J,$ as G,d as H,x as Q,ac as W,M as X,O as n,_ as i,k as Y,V as s,a5 as $,m as _,I as Z,U as x,c as ee}from"./vue.1658457169439.js";function V(){return{signIn:e=>C({url:"/api/v1/system/login",method:"post",data:e}),captcha(){return C({url:"/api/v1/pub/captcha/get",method:"get"})},signOut:e=>C({url:"/api/v1/user/signOut",method:"post",data:e})}}const oe=L({name:"loginAccount",setup(){const{t:e}=R(),o=q(),t=B(),{themeConfig:I}=j(o),m=z(),h=J(),{proxy:y}=ee(),a=G({isShowPassword:!1,ruleForm:{username:"demo",password:"123456",verifyCode:"",verifyKey:""},formRules:{username:[{required:!0,trigger:"blur",message:"\u7528\u6237\u540D\u4E0D\u80FD\u4E3A\u7A7A"}],password:[{required:!0,trigger:"blur",message:"\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A"}],verifyCode:[{required:!0,trigger:"blur",message:"\u9A8C\u8BC1\u7801\u4E0D\u80FD\u4E3A\u7A7A"}]},loading:{signIn:!1},captchaSrc:""});H(()=>{c()});const p=Q(()=>D(new Date)),c=()=>{V().captcha().then(l=>{a.captchaSrc=l.data.img,a.ruleForm.verifyKey=l.data.key})},w=()=>{y.$refs.loginForm.validate(l=>{l&&(a.loading.signIn=!0,V().signIn(a.ruleForm).then(async u=>{const d=u.data.userInfo;f.set("token",u.data.token),T.set("userName",a.ruleForm.username),f.set("userInfo",d),f.set("userMenu",u.data.menuList),f.set("permissions",u.data.permissions),await t.setBackUserInfos(d),await t.setPermissions(u.data.permissions),I.value.isRequestRoutes?(await N(),g()):(await K(),g())}).catch(()=>{a.loading.signIn=!1,c()}))}).catch(()=>{})},g=()=>{var d,r,v,F;let l=p.value;(d=m.query)!=null&&d.redirect?h.push({path:(r=m.query)==null?void 0:r.redirect,query:Object.keys((v=m.query)==null?void 0:v.params).length>0?JSON.parse((F=m.query)==null?void 0:F.params):""}):h.push("/"),a.loading.signIn=!0;const u=e("message.signInText");O.success(`${l}\uFF0C${u}`),M.start()};return A({onSignIn:w,getCaptcha:c},W(a))}}),se={class:"login-content-code"},ne=["src"];function te(e,o,t,I,m,h){const y=i("ele-User"),a=i("el-icon"),p=i("el-input"),c=i("el-form-item"),w=i("ele-Unlock"),g=i("ele-Position"),l=i("el-col"),u=i("el-button"),d=i("el-form");return Y(),X(d,{ref:"loginForm",size:"large",class:"login-content-form",model:e.ruleForm,rules:e.formRules},{default:n(()=>[s(c,{class:"login-animation1",prop:"username"},{default:n(()=>[s(p,{type:"text",placeholder:e.$t("message.account.accountPlaceholder1"),modelValue:e.ruleForm.username,"onUpdate:modelValue":o[0]||(o[0]=r=>e.ruleForm.username=r),clearable:"",autocomplete:"off"},{prefix:n(()=>[s(a,{class:"el-input__icon"},{default:n(()=>[s(y)]),_:1})]),_:1},8,["placeholder","modelValue"])]),_:1}),s(c,{class:"login-animation2",prop:"password"},{default:n(()=>[s(p,{type:e.isShowPassword?"text":"password",placeholder:e.$t("message.account.accountPlaceholder2"),modelValue:e.ruleForm.password,"onUpdate:modelValue":o[2]||(o[2]=r=>e.ruleForm.password=r),autocomplete:"off",onKeyup:$(e.onSignIn,["enter"])},{prefix:n(()=>[s(a,{class:"el-input__icon"},{default:n(()=>[s(w)]),_:1})]),suffix:n(()=>[_("i",{class:Z(["iconfont el-input__icon login-content-password",e.isShowPassword?"icon-yincangmima":"icon-xianshimima"]),onClick:o[1]||(o[1]=r=>e.isShowPassword=!e.isShowPassword)},null,2)]),_:1},8,["type","placeholder","modelValue","onKeyup"])]),_:1}),s(c,{class:"login-animation3",prop:"verifyCode"},{default:n(()=>[s(l,{span:15},{default:n(()=>[s(p,{type:"text",maxlength:"4",placeholder:e.$t("message.account.accountPlaceholder3"),modelValue:e.ruleForm.verifyCode,"onUpdate:modelValue":o[3]||(o[3]=r=>e.ruleForm.verifyCode=r),clearable:"",autocomplete:"off",onKeyup:$(e.onSignIn,["enter"])},{prefix:n(()=>[s(a,{class:"el-input__icon"},{default:n(()=>[s(g)]),_:1})]),_:1},8,["placeholder","modelValue","onKeyup"])]),_:1}),s(l,{span:1}),s(l,{span:8},{default:n(()=>[_("div",se,[_("img",{class:"login-content-code-img",onClick:o[4]||(o[4]=(...r)=>e.getCaptcha&&e.getCaptcha(...r)),width:"130",height:"38",src:e.captchaSrc,style:{cursor:"pointer"}},null,8,ne)])]),_:1})]),_:1}),s(c,{class:"login-animation4"},{default:n(()=>[s(u,{type:"primary",class:"login-content-submit",round:"",onClick:e.onSignIn,loading:e.loading.signIn},{default:n(()=>[_("span",null,x(e.$t("message.account.accountBtnText")),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model","rules"])}var ue=b(oe,[["render",te],["__scopeId","data-v-11ca6ed2"]]);export{ue as default};
